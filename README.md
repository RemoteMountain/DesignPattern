# DesignPattern
设计模式之美
https://time.geekbang.org/column/intro/100039001?tab=catalog
# 虚拟钱包
钱包系统分为虚拟钱包和三方支付


功能清单
* 充值
* 提现
* 支付
* 查询余额
* 查询交易流水

## 基于贫血模型的MVC开发模式
## 基于充血模型的DDD开发模式

# 接口鉴权
需求：只有鉴权通过的请求可以调用接口api


## 分析
* 调用方进行接口请求的时候，将 URL、AppID、密码、时间戳拼接在一起，通过加密算法生成 token，并且将 token、AppID、时间戳拼接在 URL 中，一并发送到微服务端。
* 微服务端在接收到调用方的接口请求之后，从请求中拆解出 token、AppID、时间戳。
* 微服务端首先检查传递过来的时间戳跟当前时间，是否在 token 失效时间窗口内。如果已经超过失效时间，那就算接口调用鉴权失败，拒绝接口调用请求。
* 如果 token 验证没有过期失效，微服务端再从自己的存储中，取出 AppID 对应的密码，通过同样的 token 生成算法，生成另外一个 token，与调用方传递过来的 token 进行匹配。如果一致，则鉴权成功，允许接口调用；否则就拒绝接口调用。
## 设计与实现
根据需求描述拆分功能点
1. 把URL、AppID、密码、时间戳拼接形成字符串
2. 对字符串通过加密算法加密生成token
3. 将 token、AppID、时间戳拼接到 URL 中，形成新的 URL；
4. 解析 URL，得到 token、AppID、时间戳等信息；
5. 从存储中取出 AppID 和对应的密码；
6. 根据时间戳判断 token 是否过期失效；
7. 验证两个 token 是否匹配；

# 积分兑换系统
## 需求定义
### 积分赚取和兑换规则
1、根据订单金额定义可兑换积分比例 100元的订单可以兑换10积分，兑换比例为10%
2、评论换取积分  评论后可获得1积分
3、每日签到兑换积分 签到后可获得1积分
### 积分消费和兑换规则
1、积分换算为订单金额比例   10积分可兑换1元，兑换比例为10%
2、积分兑换优惠券   100积分可兑换10元的优惠券
3、积分换购    1w积分可换购100元的商品

### 积分及其明细查询
查询用户的总积分，以及赚取积分和消费积分的历史记录。

## 系统（模块）划分
1、订单系统  --》 营销系统 --》积分系统（仅包括积分的增删改查，兑换规则在营销系统中）
2、订单系统  --》 积分系统（仅包括积分的增删改查，兑换规则在订单等系统中）
3、订单系统  --》 积分系统（包括积分的增删改查，积分兑换规则）

按照 系统设计的高内聚 低耦合
以及上层系统可以依赖下层系统，
下层系统不可依赖上层系统的原则 ，选择方案1或2 

## 系统交互
同层系统异步调用（如：基于消息系统解耦），上下层系统同步调用，此原则也是为了系统解耦。
同层系统可能存在相互依赖，通过消息队列异步调用解耦。
而，上下层系统，一般不存在相互依赖，只有上层系统依赖下层系统，则可以同步调用。

## 设计系统（模块）接口、数据库、业务模型